<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    <title>Anki PRO - Smart Flashcards</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --bg: #000000;
            --surface: #1c1c1e;
            --surface2: #2c2c2e;
            --surface3: #3a3a3c;
            --border: #38383a;
            --blue: #0a84ff;
            --green: #30d158;
            --orange: #ff9f0a;
            --red: #ff453a;
            --purple: #bf5af2;
            --indigo: #5e5ce6;
            --pink: #ff375f;
            --teal: #64d2ff;
            --yellow: #ffd60a;
            --text: #ffffff;
            --subtext: #8e8e93;
            --subtext2: #636366;
        }

        html, body {
            height: 100%;
            overflow: hidden;
            overscroll-behavior: none;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg);
            color: var(--text);
            user-select: none;
            -webkit-user-select: none;
        }

        .app-container {
            max-width: 430px;
            margin: 0 auto;
            height: 100dvh;
            display: flex;
            flex-direction: column;
            position: relative;
            background: var(--bg);
            border-left: 1px solid var(--border);
            border-right: 1px solid var(--border);
        }

        /* Header */
        .header {
            position: fixed;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 430px;
            height: 70px;
            padding: 0 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            z-index: 100;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo {
            width: 44px;
            height: 44px;
            border-radius: 14px;
            background: linear-gradient(135deg, var(--blue), var(--purple));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
            box-shadow: 0 4px 20px rgba(10, 132, 255, 0.4);
            animation: pulse-glow 2s ease-in-out infinite;
        }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 4px 20px rgba(10, 132, 255, 0.4); }
            50% { box-shadow: 0 4px 30px rgba(10, 132, 255, 0.7); }
        }

        .logo-text h1 {
            font-size: 18px;
            font-weight: 800;
        }

        .logo-text h1 span {
            color: var(--blue);
        }

        .logo-text p {
            font-size: 10px;
            color: var(--subtext);
            margin-top: -2px;
        }

        .header-right {
            display: flex;
            gap: 8px;
        }

        .header-btn {
            width: 38px;
            height: 38px;
            border-radius: 12px;
            background: var(--surface2);
            border: none;
            color: var(--subtext);
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .header-btn:active {
            transform: scale(0.9);
            opacity: 0.8;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 85px 16px 100px;
            scroll-behavior: smooth;
        }

        .main-content::-webkit-scrollbar {
            display: none;
        }

        /* Navigation */
        .nav-bar {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 430px;
            height: 85px;
            padding: 0 30px 20px;
            display: flex;
            align-items: center;
            justify-content: space-around;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            border-top: 1px solid rgba(255,255,255,0.1);
            z-index: 100;
        }

        .nav-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            background: none;
            border: none;
            color: var(--subtext);
            cursor: pointer;
            transition: all 0.3s;
            padding: 8px 20px;
        }

        .nav-btn i {
            font-size: 22px;
            transition: transform 0.3s;
        }

        .nav-btn span {
            font-size: 10px;
            font-weight: 600;
        }

        .nav-btn.active {
            color: var(--blue);
        }

        .nav-btn.active i {
            transform: scale(1.1);
        }

        .nav-btn:active {
            transform: scale(0.9);
        }

        .nav-add {
            width: 56px;
            height: 56px;
            border-radius: 18px;
            background: linear-gradient(135deg, var(--blue), var(--indigo));
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            margin-top: -30px;
            box-shadow: 0 8px 25px rgba(10, 132, 255, 0.4);
            transition: all 0.3s;
        }

        .nav-add:active {
            transform: scale(0.9);
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes bounceIn {
            0% { opacity: 0; transform: scale(0.3); }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { opacity: 1; transform: scale(1); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .animate-fade {
            animation: fadeIn 0.5s ease forwards;
        }

        .animate-slide {
            animation: slideUp 0.4s ease forwards;
        }

        .animate-bounce {
            animation: bounceIn 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;
        }

        /* Cards & Components */
        .card {
            background: var(--surface);
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.08);
            padding: 20px;
            margin-bottom: 16px;
            transition: all 0.3s;
        }

        .card:active {
            transform: scale(0.98);
            opacity: 0.9;
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(145deg, var(--surface), var(--surface2));
            border-radius: 24px;
            padding: 24px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .hero::before {
            content: '';
            position: absolute;
            top: -50px;
            right: -50px;
            width: 150px;
            height: 150px;
            background: var(--blue);
            opacity: 0.15;
            border-radius: 50%;
            filter: blur(50px);
        }

        .hero-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .hero-level {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .level-badge {
            width: 50px;
            height: 50px;
            border-radius: 16px;
            background: linear-gradient(135deg, var(--blue), var(--indigo));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: 800;
            color: white;
            box-shadow: 0 4px 15px rgba(10, 132, 255, 0.3);
        }

        .level-info p:first-child {
            font-size: 11px;
            color: var(--subtext);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .level-info p:last-child {
            font-size: 18px;
            font-weight: 700;
        }

        .streak-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            background: var(--surface);
            padding: 8px 14px;
            border-radius: 12px;
        }

        .streak-badge i {
            color: var(--orange);
        }

        .streak-badge span {
            font-weight: 700;
        }

        .progress-bar {
            height: 6px;
            background: var(--surface2);
            border-radius: 3px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--blue), var(--purple));
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        .hero-goal {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .goal-text h3 {
            font-size: 11px;
            color: var(--blue);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 4px;
        }

        .goal-text p {
            font-size: 28px;
            font-weight: 800;
        }

        .goal-text p span {
            font-size: 14px;
            font-weight: 500;
            color: var(--subtext);
        }

        .start-btn {
            padding: 14px 24px;
            background: var(--blue);
            border: none;
            border-radius: 14px;
            color: white;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(10, 132, 255, 0.3);
            transition: all 0.3s;
        }

        .start-btn:active {
            transform: scale(0.95);
        }

        /* Quote Box */
        .quote-box {
            background: rgba(10, 132, 255, 0.08);
            border: 1px solid rgba(10, 132, 255, 0.2);
            border-radius: 16px;
            padding: 16px 20px;
            margin-bottom: 20px;
            position: relative;
        }

        .quote-box::before {
            content: '"';
            position: absolute;
            top: 5px;
            left: 15px;
            font-size: 40px;
            color: var(--blue);
            opacity: 0.3;
            font-family: Georgia, serif;
        }

        .quote-box p {
            font-size: 13px;
            color: var(--subtext);
            font-style: italic;
            line-height: 1.6;
            padding-left: 25px;
        }

        /* Section Title */
        .section-title {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
            padding: 0 4px;
        }

        .section-title h2 {
            font-size: 18px;
            font-weight: 700;
        }

        .section-title span {
            font-size: 12px;
            color: var(--subtext);
        }

        /* Deck Card */
        .deck-card {
            background: var(--surface);
            border-radius: 18px;
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border: 1px solid rgba(255,255,255,0.06);
            cursor: pointer;
            transition: all 0.3s;
        }

        .deck-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .deck-card:active {
            transform: scale(0.98);
        }

        .deck-left {
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .deck-icon {
            width: 54px;
            height: 54px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            color: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .deck-info h3 {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .deck-info p {
            font-size: 12px;
            color: var(--subtext);
        }

        .deck-info p .due {
            color: var(--red);
            font-weight: 600;
        }

        .deck-right {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .deck-play {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            background: rgba(10, 132, 255, 0.15);
            border: none;
            color: var(--blue);
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .deck-play:hover {
            background: var(--blue);
            color: white;
        }

        .deck-arrow {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            background: var(--surface2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--subtext);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 50px 20px;
            border: 2px dashed var(--border);
            border-radius: 20px;
        }

        .empty-state i {
            font-size: 48px;
            color: var(--subtext);
            margin-bottom: 16px;
        }

        .empty-state p {
            color: var(--subtext);
            font-size: 14px;
        }

        /* Input Styles */
        .input-group {
            margin-bottom: 16px;
        }

        .input-group label {
            display: block;
            font-size: 11px;
            font-weight: 600;
            color: var(--subtext);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
            margin-left: 4px;
        }

        .input-field {
            width: 100%;
            padding: 16px 18px;
            background: var(--surface);
            border: 2px solid var(--border);
            border-radius: 14px;
            color: var(--text);
            font-size: 16px;
            font-family: inherit;
            outline: none;
            transition: all 0.3s;
        }

        .input-field:focus {
            border-color: var(--blue);
            background: var(--surface2);
            box-shadow: 0 0 0 4px rgba(10, 132, 255, 0.15);
        }

        .input-field::placeholder {
            color: var(--subtext2);
        }

        textarea.input-field {
            resize: none;
            min-height: 100px;
        }

        .select-wrapper {
            position: relative;
        }

        .select-wrapper select {
            appearance: none;
            -webkit-appearance: none;
            padding-right: 40px;
        }

        .select-wrapper i {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--subtext);
            pointer-events: none;
        }

        .input-hint {
            font-size: 11px;
            color: var(--blue);
            margin-top: 8px;
            margin-left: 4px;
        }

        /* Buttons */
        .btn {
            width: 100%;
            padding: 18px;
            border: none;
            border-radius: 16px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--blue), var(--indigo));
            color: white;
            box-shadow: 0 4px 20px rgba(10, 132, 255, 0.3);
        }

        .btn-secondary {
            background: var(--surface2);
            color: var(--text);
            border: 1px solid var(--border);
        }

        /* Tab Switcher */
        .tab-switcher {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4px;
            background: var(--surface2);
            padding: 4px;
            border-radius: 14px;
            margin-bottom: 24px;
        }

        .tab-btn {
            padding: 14px;
            background: transparent;
            border: none;
            border-radius: 10px;
            color: var(--subtext);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tab-btn.active {
            background: var(--surface);
            color: var(--text);
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: var(--surface);
            border-radius: 18px;
            padding: 18px;
            border: 1px solid rgba(255,255,255,0.06);
        }

        .stat-card .stat-icon {
            width: 42px;
            height: 42px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 12px;
            font-size: 18px;
        }

        .stat-card .stat-value {
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 4px;
        }

        .stat-card .stat-label {
            font-size: 11px;
            color: var(--subtext);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Heatmap */
        .heatmap-container {
            background: var(--surface);
            border-radius: 18px;
            padding: 18px;
            border: 1px solid rgba(255,255,255,0.06);
        }

        .heatmap-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 14px;
        }

        .heatmap-grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 4px;
        }

        .heat-cell {
            aspect-ratio: 1;
            border-radius: 4px;
            background: var(--surface2);
        }

        .heat-1 { background: rgba(48, 209, 88, 0.2); }
        .heat-2 { background: rgba(48, 209, 88, 0.4); }
        .heat-3 { background: rgba(48, 209, 88, 0.6); }
        .heat-4 { background: rgba(48, 209, 88, 0.8); }
        .heat-5 { background: var(--green); }

        .heatmap-legend {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 8px;
            margin-top: 12px;
            font-size: 10px;
            color: var(--subtext);
        }

        .heatmap-legend .legend-boxes {
            display: flex;
            gap: 3px;
        }

        .heatmap-legend .legend-box {
            width: 12px;
            height: 12px;
            border-radius: 3px;
        }

        /* Study Screen */
        .study-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .close-btn {
            width: 44px;
            height: 44px;
            border-radius: 14px;
            background: var(--surface2);
            border: none;
            color: var(--subtext);
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .close-btn:active {
            transform: scale(0.9);
        }

        .study-progress {
            flex: 1;
            margin: 0 16px;
        }

        .study-progress .progress-bar {
            margin-bottom: 4px;
        }

        .study-progress p {
            font-size: 11px;
            color: var(--subtext);
            text-align: center;
        }

        /* Flashcard */
        .flashcard-container {
            perspective: 2000px;
            margin-bottom: 20px;
            min-height: 350px;
        }

        .flashcard {
            width: 100%;
            height: 350px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.7s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
        }

        .flashcard.flipped {
            transform: rotateY(180deg);
        }

        .flashcard-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            border-radius: 24px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 30px;
            text-align: center;
            background: linear-gradient(145deg, var(--surface), var(--surface2));
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }

        .flashcard-face::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
        }

        .flashcard-back {
            transform: rotateY(180deg);
            background: linear-gradient(145deg, var(--surface2), #1a1a1c);
        }

        .card-label {
            position: absolute;
            top: 20px;
            font-size: 10px;
            font-weight: 600;
            color: var(--subtext);
            text-transform: uppercase;
            letter-spacing: 2px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
            width: calc(100% - 60px);
        }

        .card-content {
            font-size: 24px;
            font-weight: 600;
            line-height: 1.5;
            max-height: 200px;
            overflow-y: auto;
        }

        .card-tap-hint {
            position: absolute;
            bottom: 20px;
            font-size: 11px;
            color: var(--blue);
            opacity: 0.7;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 0.3; }
        }

        /* Cloze */
        .cloze-blank {
            display: inline-block;
            background: rgba(10, 132, 255, 0.2);
            color: var(--blue);
            padding: 4px 14px;
            border-radius: 8px;
            border: 2px dashed rgba(10, 132, 255, 0.5);
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            margin: 2px;
        }

        .cloze-blank:hover {
            background: rgba(10, 132, 255, 0.3);
        }

        .cloze-answer {
            display: inline-block;
            background: rgba(48, 209, 88, 0.2);
            color: var(--green);
            padding: 4px 14px;
            border-radius: 8px;
            border-bottom: 3px solid var(--green);
            font-weight: 800;
            animation: bounceIn 0.5s ease;
        }

        /* Show Answer Button */
        .show-answer-btn {
            width: 100%;
            padding: 20px;
            background: var(--blue);
            border: none;
            border-radius: 18px;
            color: white;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 8px 25px rgba(10, 132, 255, 0.3);
            transition: all 0.3s;
        }

        .show-answer-btn:active {
            transform: scale(0.98);
        }

        /* Rating Buttons */
        .rating-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        .rating-btn {
            padding: 16px 8px;
            border: none;
            border-radius: 16px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            transition: all 0.3s;
        }

        .rating-btn:active {
            transform: scale(0.95);
        }

        .rating-btn .rating-label {
            font-size: 12px;
            font-weight: 700;
        }

        .rating-btn .rating-time {
            font-size: 10px;
            opacity: 0.8;
        }

        .rating-again {
            background: rgba(255, 69, 58, 0.15);
            color: var(--red);
        }

        .rating-hard {
            background: rgba(255, 159, 10, 0.15);
            color: var(--orange);
        }

        .rating-good {
            background: rgba(48, 209, 88, 0.15);
            color: var(--green);
        }

        .rating-easy {
            background: rgba(10, 132, 255, 0.15);
            color: var(--blue);
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 200;
            padding: 24px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            width: 100%;
            max-width: 360px;
            animation: bounceIn 0.5s ease;
        }

        /* Complete Modal */
        .complete-modal {
            text-align: center;
        }

        .complete-icon {
            width: 120px;
            height: 120px;
            margin: 0 auto 24px;
            position: relative;
        }

        .complete-icon svg {
            width: 100%;
            height: 100%;
            transform: rotate(-90deg);
        }

        .complete-icon circle {
            fill: none;
            stroke-width: 8;
            stroke-linecap: round;
        }

        .complete-icon .bg-circle {
            stroke: var(--surface2);
        }

        .complete-icon .progress-circle {
            stroke: url(#completeGradient);
            stroke-dasharray: 339.3;
            stroke-dashoffset: 339.3;
            transition: stroke-dashoffset 1.5s ease;
        }

        .complete-icon .trophy {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            animation: float 2s ease-in-out infinite;
        }

        .complete-title {
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 8px;
        }

        .complete-subtitle {
            font-size: 14px;
            color: var(--subtext);
            margin-bottom: 24px;
        }

        .complete-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 24px;
        }

        .complete-stat {
            background: var(--surface);
            padding: 14px;
            border-radius: 14px;
        }

        .complete-stat .value {
            font-size: 24px;
            font-weight: 800;
        }

        .complete-stat .label {
            font-size: 10px;
            color: var(--subtext);
            text-transform: uppercase;
        }

        .complete-stat.xp .value { color: var(--green); }
        .complete-stat.reviewed .value { color: var(--blue); }
        .complete-stat.streak .value { color: var(--orange); }

        /* Toast */
        .toast {
            position: fixed;
            top: 90px;
            left: 50%;
            transform: translateX(-50%) translateY(-20px);
            background: var(--surface2);
            border: 1px solid var(--border);
            padding: 14px 24px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 300;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        .toast i {
            font-size: 18px;
        }

        .toast.success i { color: var(--green); }
        .toast.error i { color: var(--red); }
        .toast.warning i { color: var(--orange); }

        .toast span {
            font-size: 14px;
            font-weight: 600;
        }

        /* Footer */
        .footer-credit {
            text-align: center;
            padding: 20px;
            font-size: 11px;
            color: var(--subtext2);
        }

        /* Page Transition */
        .page {
            display: none;
        }

        .page.active {
            display: block;
            animation: fadeIn 0.4s ease;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <div class="logo">
                    <i class="fa-solid fa-bolt"></i>
                </div>
                <div class="logo-text">
                    <h1>Anki <span>PRO</span></h1>
                    <p>Smart Flashcards</p>
                </div>
            </div>
            <div class="header-right">
                <button class="header-btn" onclick="App.toggleLang()" id="langBtn">UZ</button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content" id="mainContent">
            <!-- Pages will be rendered here -->
        </main>

        <!-- Navigation -->
        <nav class="nav-bar">
            <button class="nav-btn active" id="navHome" onclick="Router.go('home')">
                <i class="fa-solid fa-house"></i>
                <span>Bosh Sahifa</span>
            </button>
            <button class="nav-add" onclick="Router.go('add')">
                <i class="fa-solid fa-plus"></i>
            </button>
            <button class="nav-btn" id="navStats" onclick="Router.go('stats')">
                <i class="fa-solid fa-chart-pie"></i>
                <span>Statistika</span>
            </button>
        </nav>
    </div>

    <!-- Complete Modal -->
    <div class="modal-overlay" id="completeModal">
        <div class="modal-content complete-modal">
            <div class="complete-icon">
                <svg viewBox="0 0 120 120">
                    <defs>
                        <linearGradient id="completeGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" stop-color="#30d158"/>
                            <stop offset="100%" stop-color="#0a84ff"/>
                        </linearGradient>
                    </defs>
                    <circle class="bg-circle" cx="60" cy="60" r="54"/>
                    <circle class="progress-circle" id="progressCircle" cx="60" cy="60" r="54"/>
                </svg>
                <div class="trophy">üèÜ</div>
            </div>
            <h2 class="complete-title" id="completeTitle">Ajoyib!</h2>
            <p class="complete-subtitle" id="completeSubtitle">Sessiya muvaffaqiyatli yakunlandi</p>
            <div class="complete-stats">
                <div class="complete-stat reviewed">
                    <div class="value" id="statReviewed">0</div>
                    <div class="label">Ko'rildi</div>
                </div>
                <div class="complete-stat xp">
                    <div class="value" id="statXP">+0</div>
                    <div class="label">XP</div>
                </div>
                <div class="complete-stat streak">
                    <div class="value" id="statStreak">0</div>
                    <div class="label">Streak</div>
                </div>
            </div>
            <button class="btn btn-primary" onclick="Study.closeModal()">
                <i class="fa-solid fa-home"></i>
                Bosh Sahifaga
            </button>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast">
        <i class="fa-solid fa-check-circle"></i>
        <span id="toastMessage">Saqlandi</span>
    </div>

    <script>
        // =====================================================
        // LOCALIZATION
        // =====================================================
        const Lang = {
            uz: {
                home: "Bosh Sahifa",
                stats: "Statistika",
                heroTitle: "Bugungi Maqsad",
                heroSub: "ta karta kutmoqda",
                heroComplete: "Barcha kartalar o'rganildi! üéâ",
                start: "Boshlash",
                decks: "To'plamlar",
                noDecks: "To'plamlar yo'q. + tugmasini bosing.",
                cards: "ta karta",
                due: "Kutilayotgan",
                addTitle: "Yangi Qo'shish",
                tabCard: "Karta",
                tabDeck: "To'plam",
                selectDeck: "To'plamni tanlang",
                question: "Savol",
                answer: "Javob",
                deckName: "To'plam nomi",
                saveCard: "Kartani Saqlash",
                createDeck: "To'plam Yaratish",
                clozeHint: "üí° Yopish: {{c1::yashirin}}",
                level: "Daraja",
                streak: "Streak",
                bestStreak: "Eng yaxshi",
                totalReviews: "Jami takrorlar",
                totalCards: "Kartalar",
                activity: "Faollik (60 kun)",
                showAnswer: "Javobni Ko'rsatish",
                again: "Qayta",
                hard: "Qiyin",
                good: "Yaxshi",
                easy: "Oson",
                left: "qoldi",
                complete: "Ajoyib!",
                completeSub: "Sessiya muvaffaqiyatli yakunlandi",
                reviewed: "Ko'rildi",
                toHome: "Bosh Sahifaga",
                saved: "Muvaffaqiyatli saqlandi!",
                error: "Maydonlarni to'ldiring!",
                noCards: "Bu to'plamda kartalar yo'q",
                questionLabel: "SAVOL",
                answerLabel: "JAVOB",
                tapToFlip: "Bosib javobni ko'ring"
            },
            en: {
                home: "Home",
                stats: "Statistics",
                heroTitle: "Today's Goal",
                heroSub: "cards waiting",
                heroComplete: "All cards done! üéâ",
                start: "Start",
                decks: "Decks",
                noDecks: "No decks. Tap + to create.",
                cards: "cards",
                due: "Due",
                addTitle: "Create New",
                tabCard: "Card",
                tabDeck: "Deck",
                selectDeck: "Select deck",
                question: "Question",
                answer: "Answer",
                deckName: "Deck name",
                saveCard: "Save Card",
                createDeck: "Create Deck",
                clozeHint: "üí° Cloze: {{c1::hidden}}",
                level: "Level",
                streak: "Streak",
                bestStreak: "Best",
                totalReviews: "Total reviews",
                totalCards: "Cards",
                activity: "Activity (60 days)",
                showAnswer: "Show Answer",
                again: "Again",
                hard: "Hard",
                good: "Good",
                easy: "Easy",
                left: "left",
                complete: "Awesome!",
                completeSub: "Session completed successfully",
                reviewed: "Reviewed",
                toHome: "Back Home",
                saved: "Saved successfully!",
                error: "Please fill all fields!",
                noCards: "No cards in this deck",
                questionLabel: "QUESTION",
                answerLabel: "ANSWER",
                tapToFlip: "Tap to reveal answer"
            }
        };

        // =====================================================
        // MOTIVATIONAL QUOTES
        // =====================================================
        const Quotes = {
            uz: [
                "Ilm olish beshikdan to qabrgacha. ‚Äî Hadis",
                "Takrorlash ‚Äî ilm onasi.",
                "Ming milya yo'l birinchi qadamdan boshlanadi. ‚Äî Lao Tzu",
                "Eng yaxshi investitsiya ‚Äî o'z aqlga qilingan.",
                "O'qigan ‚Äî o'zgan, o'qimagan ‚Äî to'zgan.",
                "Bugungi harakat ‚Äî ertangi natija.",
                "Bilim yo'li cheksiz, har qadam muhim.",
                "Sabr ‚Äî muvaffaqiyat kaliti.",
                "Ilm ‚Äî zulmatda nur.",
                "Har bir karta ‚Äî kelajakka g'isht."
            ],
            en: [
                "Knowledge is power. ‚Äî Francis Bacon",
                "Repetition is the mother of learning.",
                "A journey begins with a single step. ‚Äî Lao Tzu",
                "The best investment is in yourself.",
                "Today a reader, tomorrow a leader.",
                "Small daily improvements lead to big results.",
                "The mind is a fire to be kindled.",
                "Patience is the key to success.",
                "Learning is a treasure.",
                "Every card is a brick in your palace."
            ]
        };

        // =====================================================
        // DATABASE
        // =====================================================
        const DB = {
            key: 'anki_pro_final_v5',
            data: null,

            init() {
                const saved = localStorage.getItem(this.key);
                if (saved) {
                    try {
                        this.data = JSON.parse(saved);
                    } catch (e) {
                        this.reset();
                    }
                } else {
                    this.reset();
                }
                this.syncStreak();
            },

            reset() {
                const now = Date.now();
                this.data = {
                    lang: 'uz',
                    user: {
                        xp: 0,
                        streak: 0,
                        bestStreak: 0,
                        lastStudy: null,
                        totalReviews: 0,
                        todayReviews: 0,
                        todayDate: null,
                        heatmap: {}
                    },
                    decks: [
                        { id: 'd1', name: 'English Vocabulary', icon: 'fa-language', gradient: 'linear-gradient(135deg, #0a84ff, #5e5ce6)' },
                        { id: 'd2', name: 'Dasturlash', icon: 'fa-code', gradient: 'linear-gradient(135deg, #ff9f0a, #ff453a)' }
                    ],
                    cards: [
                        { id: 'c1', deckId: 'd1', type: 'basic', front: 'Perseverance', back: "Qat'iyatlilik, sabr", interval: 0, ease: 2.5, due: now, state: 'new', reviews: 0, lapses: 0 },
                        { id: 'c2', deckId: 'd1', type: 'basic', front: 'Commitment', back: "Majburiyat, sadoqat", interval: 0, ease: 2.5, due: now, state: 'new', reviews: 0, lapses: 0 },
                        { id: 'c3', deckId: 'd1', type: 'cloze', front: "O'zbekiston poytaxti {{c1::Toshkent}}.", back: '', interval: 0, ease: 2.5, due: now, state: 'new', reviews: 0, lapses: 0 },
                        { id: 'c4', deckId: 'd2', type: 'basic', front: 'Algoritm nima?', back: "Muammoni yechish uchun aniq qadamlar ketma-ketligi", interval: 0, ease: 2.5, due: now, state: 'new', reviews: 0, lapses: 0 },
                        { id: 'c5', deckId: 'd2', type: 'cloze', front: "{{c1::JavaScript}} ‚Äî web dasturlash tili.", back: '', interval: 0, ease: 2.5, due: now, state: 'new', reviews: 0, lapses: 0 }
                    ]
                };
                this.save();
            },

            save() {
                localStorage.setItem(this.key, JSON.stringify(this.data));
            },

            syncStreak() {
                const today = new Date().toISOString().split('T')[0];
                const user = this.data.user;
                
                if (user.todayDate !== today) {
                    user.todayDate = today;
                    user.todayReviews = 0;
                }
                
                if (user.lastStudy) {
                    const last = new Date(user.lastStudy);
                    const curr = new Date(today);
                    const diff = Math.floor((curr - last) / 86400000);
                    if (diff > 1) user.streak = 0;
                }
                
                this.save();
            },

            updateStreak() {
                const today = new Date().toISOString().split('T')[0];
                const user = this.data.user;
                
                if (user.lastStudy !== today) {
                    const yesterday = new Date(Date.now() - 86400000).toISOString().split('T')[0];
                    if (user.lastStudy === yesterday || !user.lastStudy) {
                        user.streak++;
                    } else {
                        user.streak = 1;
                    }
                    user.lastStudy = today;
                    if (user.streak > user.bestStreak) user.bestStreak = user.streak;
                }
                
                if (!user.heatmap[today]) user.heatmap[today] = 0;
                user.heatmap[today]++;
                user.todayReviews++;
                user.totalReviews++;
                
                this.save();
            }
        };

        // =====================================================
        // SM-2 ALGORITHM
        // =====================================================
        const SM2 = {
            LEARNING_STEPS: [1, 10],
            GRADUATING_INTERVAL: 1,
            EASY_INTERVAL: 4,
            MIN_EASE: 1.3,
            MAX_EASE: 2.5,
            DAY: 86400000,
            MIN: 60000,

            formatTime(ms) {
                if (ms < this.MIN) return '<1m';
                if (ms < this.MIN * 60) return Math.round(ms / this.MIN) + 'm';
                if (ms < this.DAY) return Math.round(ms / (this.MIN * 60)) + 'h';
                return Math.round(ms / this.DAY) + 'd';
            },

            getIntervals(card) {
                const state = card.state || 'new';
                const interval = card.interval || 0;
                const ease = card.ease || 2.5;
                const intervals = {};

                if (state === 'new' || state === 'learning') {
                    intervals[1] = this.LEARNING_STEPS[0] * this.MIN;
                    intervals[2] = this.LEARNING_STEPS[1] * this.MIN;
                    intervals[3] = this.GRADUATING_INTERVAL * this.DAY;
                    intervals[4] = this.EASY_INTERVAL * this.DAY;
                } else {
                    intervals[1] = 10 * this.MIN;
                    intervals[2] = Math.max(1, interval * 1.2) * this.DAY;
                    intervals[3] = Math.max(1, interval * ease) * this.DAY;
                    intervals[4] = Math.max(1, interval * ease * 1.3) * this.DAY;
                }

                return intervals;
            },

            updateCard(card, rating, intervals) {
                const now = Date.now();
                const state = card.state || 'new';

                // Ease adjustment
                if (state === 'review') {
                    if (rating === 1) card.ease = Math.max(this.MIN_EASE, card.ease - 0.2);
                    else if (rating === 2) card.ease = Math.max(this.MIN_EASE, card.ease - 0.15);
                    else if (rating === 4) card.ease = Math.min(this.MAX_EASE, card.ease + 0.15);
                }

                // State & interval update
                if (state === 'new' || state === 'learning') {
                    if (rating === 1 || rating === 2) {
                        card.state = 'learning';
                        card.interval = 0;
                    } else if (rating === 3) {
                        card.state = 'review';
                        card.interval = this.GRADUATING_INTERVAL;
                    } else {
                        card.state = 'review';
                        card.interval = this.EASY_INTERVAL;
                    }
                } else {
                    if (rating === 1) {
                        card.state = 'learning';
                        card.lapses = (card.lapses || 0) + 1;
                        card.interval = Math.max(1, Math.round(card.interval * 0.5));
                    } else {
                        card.interval = Math.round(intervals[rating] / this.DAY);
                    }
                }

                card.due = now + intervals[rating];
                card.reviews = (card.reviews || 0) + 1;

                return card;
            },

            calculateXP(rating) {
                const base = { 1: 2, 2: 5, 3: 10, 4: 15 };
                return base[rating] + Math.min(DB.data.user.streak, 10);
            }
        };

        // =====================================================
        // APP CONTROLLER
        // =====================================================
        const App = {
            lang: 'uz',

            init() {
                DB.init();
                this.lang = DB.data.lang;
                this.updateLangBtn();
                Router.go('home');
            },

            t(key) {
                return Lang[this.lang][key] || key;
            },

            getQuote() {
                const quotes = Quotes[this.lang];
                return quotes[Math.floor(Math.random() * quotes.length)];
            },

            toggleLang() {
                this.lang = this.lang === 'uz' ? 'en' : 'uz';
                DB.data.lang = this.lang;
                DB.save();
                this.updateLangBtn();
                Router.refresh();
            },

            updateLangBtn() {
                document.getElementById('langBtn').textContent = this.lang.toUpperCase();
            },

            toast(msg, type = 'success') {
                const toast = document.getElementById('toast');
                const message = document.getElementById('toastMessage');
                const icon = toast.querySelector('i');

                message.textContent = msg;
                toast.className = 'toast show ' + type;
                
                if (type === 'success') icon.className = 'fa-solid fa-check-circle';
                else if (type === 'error') icon.className = 'fa-solid fa-circle-exclamation';
                else icon.className = 'fa-solid fa-triangle-exclamation';

                setTimeout(() => toast.classList.remove('show'), 2500);
            },

            confetti() {
                // Simple confetti effect using CSS
                const colors = ['#0a84ff', '#30d158', '#ff9f0a', '#5e5ce6', '#ff375f'];
                for (let i = 0; i < 50; i++) {
                    const confetti = document.createElement('div');
                    confetti.style.cssText = `
                        position: fixed;
                        width: 10px;
                        height: 10px;
                        background: ${colors[Math.floor(Math.random() * colors.length)]};
                        left: ${Math.random() * 100}vw;
                        top: -10px;
                        border-radius: 50%;
                        z-index: 1000;
                        animation: confettiFall ${2 + Math.random() * 2}s linear forwards;
                    `;
                    document.body.appendChild(confetti);
                    setTimeout(() => confetti.remove(), 4000);
                }
            }
        };

        // Add confetti animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes confettiFall {
                to {
                    transform: translateY(100vh) rotate(720deg);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);

        // =====================================================
        // ROUTER
        // =====================================================
        const Router = {
            current: 'home',
            params: null,

            go(page, params = null) {
                this.current = page;
                this.params = params;

                // Update nav
                document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
                if (page === 'home') document.getElementById('navHome').classList.add('active');
                else if (page === 'stats') document.getElementById('navStats').classList.add('active');

                // Update nav text
                document.querySelector('#navHome span').textContent = App.t('home');
                document.querySelector('#navStats span').textContent = App.t('stats');

                // Render page
                const main = document.getElementById('mainContent');
                main.innerHTML = '';
                main.scrollTop = 0;

                switch (page) {
                    case 'home': Pages.home(main); break;
                    case 'add': Pages.add(main); break;
                    case 'stats': Pages.stats(main); break;
                    case 'study': Pages.study(main); break;
                }
            },

            refresh() {
                this.go(this.current, this.params);
            }
        };

        // =====================================================
        // PAGES
        // =====================================================
        const Pages = {
            home(container) {
                const now = Date.now();
                const totalDue = DB.data.cards.filter(c => c.due <= now).length;
                const user = DB.data.user;
                const level = Math.floor(user.xp / 100) + 1;
                const xpProgress = user.xp % 100;

                let html = `
                    <div class="animate-fade">
                        <!-- Hero -->
                        <div class="hero">
                            <div class="hero-header">
                                <div class="hero-level">
                                    <div class="level-badge">${level}</div>
                                    <div class="level-info">
                                        <p>${App.t('level')}</p>
                                        <p>${user.xp} XP</p>
                                    </div>
                                </div>
                                <div class="streak-badge">
                                    <i class="fa-solid fa-fire"></i>
                                    <span>${user.streak}</span>
                                </div>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${xpProgress}%"></div>
                            </div>
                            <div class="hero-goal">
                                <div class="goal-text">
                                    <h3>${App.t('heroTitle')}</h3>
                                    ${totalDue > 0 
                                        ? `<p>${totalDue} <span>${App.t('heroSub')}</span></p>`
                                        : `<p style="font-size:16px;color:var(--green)">${App.t('heroComplete')}</p>`
                                    }
                                </div>
                                ${totalDue > 0 ? `
                                    <button class="start-btn" onclick="Study.startAll()">
                                        <i class="fa-solid fa-play"></i>
                                        ${App.t('start')}
                                    </button>
                                ` : ''}
                            </div>
                        </div>

                        <!-- Quote -->
                        <div class="quote-box">
                            <p>${App.getQuote()}</p>
                        </div>

                        <!-- Decks -->
                        <div class="section-title">
                            <h2>${App.t('decks')}</h2>
                            <span>${DB.data.decks.length} ta</span>
                        </div>
                `;

                if (DB.data.decks.length === 0) {
                    html += `
                        <div class="empty-state">
                            <i class="fa-solid fa-folder-open"></i>
                            <p>${App.t('noDecks')}</p>
                        </div>
                    `;
                } else {
                    DB.data.decks.forEach((deck, i) => {
                        const cards = DB.data.cards.filter(c => c.deckId === deck.id);
                        const due = cards.filter(c => c.due <= now).length;

                        html += `
                            <div class="deck-card animate-slide" style="animation-delay: ${i * 0.1}s" onclick="Router.go('study', {deckId: '${deck.id}'})">
                                <div class="deck-left">
                                    <div class="deck-icon" style="background: ${deck.gradient}">
                                        <i class="fa-solid ${deck.icon}"></i>
                                    </div>
                                    <div class="deck-info">
                                        <h3>${deck.name}</h3>
                                        <p>${cards.length} ${App.t('cards')} ${due > 0 ? `‚Ä¢ <span class="due">${due} ${App.t('due')}</span>` : ''}</p>
                                    </div>
                                </div>
                                <div class="deck-right">
                                    ${due > 0 ? `
                                        <button class="deck-play" onclick="event.stopPropagation(); Study.start('${deck.id}')">
                                            <i class="fa-solid fa-play"></i>
                                        </button>
                                    ` : ''}
                                    <div class="deck-arrow">
                                        <i class="fa-solid fa-chevron-right"></i>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                }

                html += `
                        <div class="footer-credit">Made by ¬©Ô∏èMuhammad Daler</div>
                    </div>
                `;

                container.innerHTML = html;
            },

            add(container) {
                const decks = DB.data.decks.map(d => `<option value="${d.id}">${d.name}</option>`).join('');

                container.innerHTML = `
                    <div class="animate-fade">
                        <h2 style="font-size:24px;font-weight:800;margin-bottom:20px">${App.t('addTitle')}</h2>

                        <div class="tab-switcher">
                            <button class="tab-btn active" id="tabCard" onclick="UI.switchTab('card')">
                                <i class="fa-solid fa-clone"></i> ${App.t('tabCard')}
                            </button>
                            <button class="tab-btn" id="tabDeck" onclick="UI.switchTab('deck')">
                                <i class="fa-solid fa-folder"></i> ${App.t('tabDeck')}
                            </button>
                        </div>

                        <!-- Card Form -->
                        <div id="cardForm">
                            <div class="input-group">
                                <label>${App.t('selectDeck')}</label>
                                <div class="select-wrapper">
                                    <select class="input-field" id="inputDeck">
                                        ${decks || `<option value="">--</option>`}
                                    </select>
                                    <i class="fa-solid fa-chevron-down"></i>
                                </div>
                            </div>

                            <div class="input-group">
                                <label>${App.t('question')}</label>
                                <textarea class="input-field" id="inputFront" placeholder="..."></textarea>
                                <p class="input-hint">${App.t('clozeHint')}</p>
                            </div>

                            <div class="input-group" id="backGroup">
                                <label>${App.t('answer')}</label>
                                <textarea class="input-field" id="inputBack" placeholder="..."></textarea>
                            </div>

                            <button class="btn btn-primary" onclick="Actions.saveCard()">
                                <i class="fa-solid fa-plus"></i>
                                ${App.t('saveCard')}
                            </button>
                        </div>

                        <!-- Deck Form -->
                        <div id="deckForm" style="display:none">
                            <div class="input-group">
                                <label>${App.t('deckName')}</label>
                                <input type="text" class="input-field" id="inputDeckName" placeholder="...">
                            </div>

                            <button class="btn btn-secondary" onclick="Actions.saveDeck()">
                                <i class="fa-solid fa-folder-plus"></i>
                                ${App.t('createDeck')}
                            </button>
                        </div>

                        <div class="footer-credit">Made by ¬©Ô∏èMuhammad Daler</div>
                    </div>
                `;
            },

            stats(container) {
                const user = DB.data.user;
                const level = Math.floor(user.xp / 100) + 1;

                // Heatmap
                let heatmap = '';
                const today = new Date();
                for (let i = 0; i < 60; i++) {
                    const date = new Date(today);
                    date.setDate(today.getDate() - (59 - i));
                    const key = date.toISOString().split('T')[0];
                    const count = user.heatmap[key] || 0;

                    let heatClass = 'heat-cell';
                    if (count >= 1 && count < 5) heatClass += ' heat-1';
                    else if (count >= 5 && count < 10) heatClass += ' heat-2';
                    else if (count >= 10 && count < 20) heatClass += ' heat-3';
                    else if (count >= 20 && count < 30) heatClass += ' heat-4';
                    else if (count >= 30) heatClass += ' heat-5';

                    heatmap += `<div class="${heatClass}"></div>`;
                }

                container.innerHTML = `
                    <div class="animate-fade">
                        <!-- Profile -->
                        <div style="text-align:center;margin-bottom:24px">
                            <div style="width:90px;height:90px;border-radius:24px;background:linear-gradient(135deg,var(--blue),var(--purple));margin:0 auto 16px;display:flex;align-items:center;justify-content:center;font-size:36px;font-weight:800;color:white;box-shadow:0 8px 30px rgba(10,132,255,0.4)">
                                ${level}
                            </div>
                            <h2 style="font-size:22px;font-weight:800">${App.t('level')} ${level}</h2>
                            <p style="color:var(--subtext)">${user.xp} XP</p>
                        </div>

                        <!-- Stats Grid -->
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-icon" style="background:rgba(255,159,10,0.15)">
                                    <i class="fa-solid fa-fire" style="color:var(--orange)"></i>
                                </div>
                                <div class="stat-value">${user.streak}</div>
                                <div class="stat-label">${App.t('streak')}</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon" style="background:rgba(94,92,230,0.15)">
                                    <i class="fa-solid fa-trophy" style="color:var(--indigo)"></i>
                                </div>
                                <div class="stat-value">${user.bestStreak}</div>
                                <div class="stat-label">${App.t('bestStreak')}</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon" style="background:rgba(48,209,88,0.15)">
                                    <i class="fa-solid fa-check-double" style="color:var(--green)"></i>
                                </div>
                                <div class="stat-value">${user.totalReviews}</div>
                                <div class="stat-label">${App.t('totalReviews')}</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon" style="background:rgba(10,132,255,0.15)">
                                    <i class="fa-solid fa-layer-group" style="color:var(--blue)"></i>
                                </div>
                                <div class="stat-value">${DB.data.cards.length}</div>
                                <div class="stat-label">${App.t('totalCards')}</div>
                            </div>
                        </div>

                        <!-- Heatmap -->
                        <div class="heatmap-container">
                            <h3 class="heatmap-title">${App.t('activity')}</h3>
                            <div class="heatmap-grid">${heatmap}</div>
                            <div class="heatmap-legend">
                                <span>Kam</span>
                                <div class="legend-boxes">
                                    <div class="legend-box" style="background:var(--surface2)"></div>
                                    <div class="legend-box heat-1"></div>
                                    <div class="legend-box heat-2"></div>
                                    <div class="legend-box heat-3"></div>
                                    <div class="legend-box heat-5"></div>
                                </div>
                                <span>Ko'p</span>
                            </div>
                        </div>

                        <div class="footer-credit">Made by ¬©Ô∏èMuhammad Daler</div>
                    </div>
                `;
            },

            study(container) {
                container.innerHTML = `<div id="studyArea" class="animate-fade"></div>`;
            }
        };

        // =====================================================
        // UI HELPERS
        // =====================================================
        const UI = {
            switchTab(tab) {
                const cardForm = document.getElementById('cardForm');
                const deckForm = document.getElementById('deckForm');
                const tabCard = document.getElementById('tabCard');
                const tabDeck = document.getElementById('tabDeck');

                if (tab === 'card') {
                    cardForm.style.display = 'block';
                    deckForm.style.display = 'none';
                    tabCard.classList.add('active');
                    tabDeck.classList.remove('active');
                } else {
                    cardForm.style.display = 'none';
                    deckForm.style.display = 'block';
                    tabDeck.classList.add('active');
                    tabCard.classList.remove('active');
                }
            }
        };

        // =====================================================
        // ACTIONS
        // =====================================================
        const Actions = {
            saveCard() {
                const deckId = document.getElementById('inputDeck').value;
                const front = document.getElementById('inputFront').value.trim();
                const back = document.getElementById('inputBack').value.trim();

                if (!deckId || !front) {
                    App.toast(App.t('error'), 'error');
                    return;
                }

                const isCloze = /{{c\d::(.*?)}}/.test(front);
                if (!isCloze && !back) {
                    App.toast(App.t('error'), 'error');
                    return;
                }

                const now = Date.now();
                DB.data.cards.push({
                    id: 'c' + now,
                    deckId: deckId,
                    type: isCloze ? 'cloze' : 'basic',
                    front: front,
                    back: isCloze ? '' : back,
                    interval: 0,
                    ease: 2.5,
                    due: now,
                    state: 'new',
                    reviews: 0,
                    lapses: 0
                });
                DB.save();

                document.getElementById('inputFront').value = '';
                document.getElementById('inputBack').value = '';
                App.toast(App.t('saved'));
            },

            saveDeck() {
                const name = document.getElementById('inputDeckName').value.trim();
                if (!name) {
                    App.toast(App.t('error'), 'error');
                    return;
                }

                const gradients = [
                    'linear-gradient(135deg, #0a84ff, #5e5ce6)',
                    'linear-gradient(135deg, #ff9f0a, #ff453a)',
                    'linear-gradient(135deg, #30d158, #00c7be)',
                    'linear-gradient(135deg, #bf5af2, #ff375f)',
                    'linear-gradient(135deg, #64d2ff, #0a84ff)'
                ];
                const icons = ['fa-book', 'fa-code', 'fa-atom', 'fa-globe', 'fa-brain', 'fa-flask'];

                DB.data.decks.push({
                    id: 'd' + Date.now(),
                    name: name,
                    icon: icons[Math.floor(Math.random() * icons.length)],
                    gradient: gradients[Math.floor(Math.random() * gradients.length)]
                });
                DB.save();

                document.getElementById('inputDeckName').value = '';
                UI.switchTab('card');
                Router.go('add');
                App.toast(App.t('saved'));
            }
        };

        // =====================================================
        // STUDY ENGINE
        // =====================================================
        const Study = {
            queue: [],
            current: null,
            currentIndex: 0,
            totalCount: 0,
            flipped: false,
            intervals: {},
            sessionXP: 0,
            sessionReviews: 0,

            start(deckId) {
                const now = Date.now();
                this.queue = DB.data.cards
                    .filter(c => c.deckId === deckId && c.due <= now)
                    .sort((a, b) => a.due - b.due);

                if (this.queue.length === 0) {
                    App.toast(App.t('noCards'), 'warning');
                    return;
                }

                this.totalCount = this.queue.length;
                this.currentIndex = 0;
                this.sessionXP = 0;
                this.sessionReviews = 0;

                Router.go('study');
                setTimeout(() => this.next(), 100);
            },

            startAll() {
                const now = Date.now();
                this.queue = DB.data.cards
                    .filter(c => c.due <= now)
                    .sort((a, b) => a.due - b.due);

                if (this.queue.length === 0) {
                    App.toast(App.t('noCards'), 'warning');
                    return;
                }

                this.totalCount = this.queue.length;
                this.currentIndex = 0;
                this.sessionXP = 0;
                this.sessionReviews = 0;

                Router.go('study');
                setTimeout(() => this.next(), 100);
            },

            next() {
                if (this.queue.length === 0) {
                    this.complete();
                    return;
                }

                this.current = this.queue.shift();
                this.currentIndex++;
                this.flipped = false;
                this.intervals = SM2.getIntervals(this.current);
                this.render();
            },

            render() {
                const area = document.getElementById('studyArea');
                if (!area || !this.current) return;

                const card = this.current;
                const progress = Math.round((this.currentIndex / this.totalCount) * 100);

                let frontContent = card.front;
                let backContent = card.back;

                if (card.type === 'cloze') {
                    frontContent = card.front.replace(/{{c\d::(.*?)}}/g, '<span class="cloze-blank">[ ? ]</span>');
                    backContent = card.front.replace(/{{c\d::(.*?)}}/g, '<span class="cloze-answer">$1</span>');
                }

                area.innerHTML = `
                    <div class="study-header">
                        <button class="close-btn" onclick="Router.go('home')">
                            <i class="fa-solid fa-xmark"></i>
                        </button>
                        <div class="study-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width:${progress}%"></div>
                            </div>
                            <p>${this.currentIndex}/${this.totalCount} ‚Äî ${this.queue.length} ${App.t('left')}</p>
                        </div>
                        <div style="width:44px"></div>
                    </div>

                    <div class="flashcard-container" onclick="Study.flip()">
                        <div class="flashcard ${this.flipped ? 'flipped' : ''}" id="flashcard">
                            <div class="flashcard-face">
                                <div class="card-label">${App.t('questionLabel')}</div>
                                <div class="card-content">${frontContent}</div>
                                <div class="card-tap-hint">${App.t('tapToFlip')}</div>
                            </div>
                            <div class="flashcard-face flashcard-back">
                                <div class="card-label">${App.t('answerLabel')}</div>
                                <div class="card-content">${backContent}</div>
                            </div>
                        </div>
                    </div>

                    <div id="studyButtons">
                        ${this.flipped ? this.getRatingButtons() : `
                            <button class="show-answer-btn" onclick="Study.flip()">
                                <i class="fa-solid fa-eye"></i> ${App.t('showAnswer')}
                            </button>
                        `}
                    </div>
                `;
            },

            getRatingButtons() {
                const t1 = SM2.formatTime(this.intervals[1]);
                const t2 = SM2.formatTime(this.intervals[2]);
                const t3 = SM2.formatTime(this.intervals[3]);
                const t4 = SM2.formatTime(this.intervals[4]);

                return `
                    <div class="rating-buttons">
                        <button class="rating-btn rating-again" onclick="Study.rate(1)">
                            <span class="rating-label">${App.t('again')}</span>
                            <span class="rating-time">${t1}</span>
                        </button>
                        <button class="rating-btn rating-hard" onclick="Study.rate(2)">
                            <span class="rating-label">${App.t('hard')}</span>
                            <span class="rating-time">${t2}</span>
                        </button>
                        <button class="rating-btn rating-good" onclick="Study.rate(3)">
                            <span class="rating-label">${App.t('good')}</span>
                            <span class="rating-time">${t3}</span>
                        </button>
                        <button class="rating-btn rating-easy" onclick="Study.rate(4)">
                            <span class="rating-label">${App.t('easy')}</span>
                            <span class="rating-time">${t4}</span>
                        </button>
                    </div>
                `;
            },

            flip() {
                if (this.flipped) return;
                this.flipped = true;

                const card = document.getElementById('flashcard');
                if (card) card.classList.add('flipped');

                const buttons = document.getElementById('studyButtons');
                if (buttons) buttons.innerHTML = this.getRatingButtons();
            },

            rate(rating) {
                if (!this.current) return;

                // Update card
                SM2.updateCard(this.current, rating, this.intervals);

                // Find and update in DB
                const idx = DB.data.cards.findIndex(c => c.id === this.current.id);
                if (idx !== -1) {
                    DB.data.cards[idx] = this.current;
                }

                // Update user stats
                const xp = SM2.calculateXP(rating);
                DB.data.user.xp += xp;
                this.sessionXP += xp;
                this.sessionReviews++;
                DB.updateStreak();
                DB.save();

                // Next card
                if (rating === 1) {
                    // Put back in queue
                    this.queue.push(this.current);
                }

                this.next();
            },

            complete() {
                App.confetti();

                document.getElementById('statReviewed').textContent = this.sessionReviews;
                document.getElementById('statXP').textContent = '+' + this.sessionXP;
                document.getElementById('statStreak').textContent = DB.data.user.streak;
                document.getElementById('completeTitle').textContent = App.t('complete');
                document.getElementById('completeSubtitle').textContent = App.t('completeSub');

                const modal = document.getElementById('completeModal');
                modal.classList.add('active');

                // Animate progress circle
                setTimeout(() => {
                    document.getElementById('progressCircle').style.strokeDashoffset = '0';
                }, 100);
            },

            closeModal() {
                document.getElementById('completeModal').classList.remove('active');
                document.getElementById('progressCircle').style.strokeDashoffset = '339.3';
                Router.go('home');
            }
        };

        // =====================================================
        // INITIALIZE
        // =====================================================
        document.addEventListener('DOMContentLoaded', () => {
            App.init();
        });
    </script>
</body>
</html>
