<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <title>Nur & Ilm — Digital Tadabbur</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      background: #050505;
      overflow: hidden;
      font-family: system-ui, sans-serif;
      color: #f2f2f2;
    }

    canvas { display: block; }

    #start-overlay {
      position: fixed;
      inset: 0;
      background: #050505;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
    }

    #start-overlay button {
      background: none;
      border: 1px solid #d4af37;
      color: #d4af37;
      padding: 16px 36px;
      font-size: 16px;
      letter-spacing: 0.1em;
      cursor: pointer;
    }

    #text-overlay {
      position: fixed;
      top: 28px;
      width: 100%;
      text-align: center;
      pointer-events: none;
      z-index: 5;
    }

    #ayah {
      font-size: 26px;
      line-height: 1.9;
      opacity: 0;
      transition: opacity 3s ease;
    }

    #translation {
      margin-top: 6px;
      font-size: 13px;
      opacity: 0.6;
    }
  </style>

  <!-- THREE -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>

  <!-- MEDIAPIPE -->
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
</head>

<body>

<div id="start-overlay">
  <button id="start-btn">BOSHLASH</button>
</div>

<div id="text-overlay">
  <div id="ayah">﴿اللَّهُ نُورُ السَّمَاوَاتِ وَالْأَرْضِ﴾</div>
  <div id="translation">Alloh osmonlar va yerning nuridir</div>
</div>

<script>
/* ============================================================
   THREE.JS SAHNA
   ============================================================ */
const scene = new THREE.Scene();

const camera = new THREE.PerspectiveCamera(
  60,
  innerWidth / innerHeight,
  0.1,
  100
);
camera.position.z = 3;

const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(innerWidth, innerHeight);
renderer.setClearColor(0x050505);
document.body.appendChild(renderer.domElement);

/* ZARRALAR */
const COUNT = 15000;
const geometry = new THREE.BufferGeometry();
const positions = new Float32Array(COUNT * 3);

for (let i = 0; i < COUNT; i++) {
  const r = Math.cbrt(Math.random());
  const t = Math.random() * Math.PI * 2;
  const p = Math.acos(2 * Math.random() - 1);

  positions[i*3]   = r * Math.sin(p) * Math.cos(t);
  positions[i*3+1] = r * Math.sin(p) * Math.sin(t);
  positions[i*3+2] = r * Math.cos(p);
}

geometry.setAttribute("position", new THREE.BufferAttribute(positions, 3));

const material = new THREE.PointsMaterial({
  color: 0xfff6cc,
  size: 0.01,
  blending: THREE.AdditiveBlending,
  depthWrite: false
});

const particles = new THREE.Points(geometry, material);
scene.add(particles);

/* ============================================================
   IKKI QO‘L → QALB ↔ KOINOT
   ============================================================ */
let targetZ = 3;

function applyTwoHands(hands) {
  if (hands.length === 2) {
    const a = hands[0][8];
    const b = hands[1][8];

    const dx = a.x - b.x;
    const dy = a.y - b.y;
    const dist = Math.sqrt(dx * dx + dy * dy);

    // yaqin → qalb (2)
    // uzoq → koinot (6)
    targetZ = THREE.MathUtils.clamp(
      THREE.MathUtils.mapLinear(dist, 0.1, 0.6, 2, 6),
      2,
      6
    );
  }
}

/* ============================================================
   MEDIAPIPE
   ============================================================ */
const hands = new Hands({
  locateFile: f => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${f}`
});

hands.setOptions({
  maxNumHands: 2,
  modelComplexity: 1,
  minDetectionConfidence: 0.7,
  minTrackingConfidence: 0.7
});

hands.onResults(res => {
  if (res.multiHandLandmarks) {
    applyTwoHands(res.multiHandLandmarks);
  }
});

const video = document.createElement("video");
video.style.display = "none";
document.body.appendChild(video);

const cam = new Camera(video, {
  onFrame: async () => {
    await hands.send({ image: video });
  },
  width: 640,
  height: 480
});

/* ============================================================
   ANIMATSIYA — NAFASGA O‘XSHASH
   ============================================================ */
function animate() {
  camera.position.z += (targetZ - camera.position.z) * 0.04;
  renderer.render(scene, camera);
  requestAnimationFrame(animate);
}

/* ============================================================
   START
   ============================================================ */
document.getElementById("start-btn").onclick = () => {
  document.getElementById("start-overlay").remove();
  document.getElementById("ayah").style.opacity = 1;
  cam.start();
  animate();
};
</script>

</body>
</html>
</file>

</project>